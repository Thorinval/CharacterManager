@page "/settings"
@attribute [Microsoft.AspNetCore.Authorization.Authorize]
@using CharacterManager.Server.Data
@using CharacterManager.Server.Models
@using CharacterManager.Server.Services
@using Microsoft.EntityFrameworkCore
@using Microsoft.AspNetCore.Components.Authorization
@rendermode InteractiveServer

<link rel="stylesheet" href="/Styles/Settings.css" />

<PageTitle><LocalizedText Key="settings.title" /> - Character Manager</PageTitle>

<div class="page-header-banner">
    <img src="/images/interface/parametres.png" alt="" class="page-header-icon" />
    <h1 class="page-title"><LocalizedText Key="settings.title" /></h1>
</div>

<AuthorizeView>
    <Authorized>
<div class="settings-container">
    <!-- Section Langue -->
    <div class="settings-section">
        <div class="section-header">
            <h2><LocalizedText Key="settings.title" /></h2>
        </div>

        <div class="setting-item">
            <div class="setting-label">
                <h3><LocalizedText Key="settings.language" /></h3>
                <p class="setting-description">
                    <LocalizedText Key="settings.languageDescription" />
                </p>
            </div>
            <div class="setting-control">
                <select class="form-select" @bind="currentLanguage" @bind:after="OnLanguageChanged">
                    @foreach (var lang in availableLanguages)
                    {
                        <option value="@lang.Code">@lang.Name</option>
                    }
                </select>
            </div>
        </div>
    </div>

    <!-- Section Mode Adulte -->
    <div class="settings-section">
        <div class="section-header">
            <h2><LocalizedText Key="settings.contentMode" /></h2>
        </div>

        <div class="setting-item">
            <div class="setting-label">
                <h3><LocalizedText Key="settings.adultMode" /></h3>
                <p class="setting-description">
                    <LocalizedText Key="settings.adultModeDescription" />
                </p>
            </div>
            <div class="setting-control">
                <div class="form-check form-switch">
                    <input 
                        class="form-check-input" 
                        type="checkbox" 
                        id="adultModeToggle"
                        @bind:get="isAdultModeEnabled"
                        @bind:set="async (value) => { isAdultModeEnabled = value; await OnAdultModeChanged(); }"
                        disabled="@(!IsAdmin)" />
                    <label class="form-check-label" for="adultModeToggle">
                        @(isAdultModeEnabled ? LocalizationService.T("settings.enabled") : LocalizationService.T("settings.disabled"))
                    </label>
                </div>
            </div>
        </div>
    </div>

    <!-- Section Ã€ propos -->
    <div class="settings-section">
        <div class="section-header">
            <h2><LocalizedText Key="settings.subtitle" /></h2>
        </div>
        <div class="about-info">
            <p><strong>Character Manager</strong></p>
            <p>Version: @appVersion</p>
            <p class="text-muted"><LocalizedText Key="settings.version" /></p>
        </div>
    </div>
</div>
    </Authorized>
    <NotAuthorized>
        <div class="container mt-4">
            <p><LocalizedText Key="settings.signInPrompt" /></p>
            <a class="btn btn-primary" href="/login"><LocalizedText Key="settings.signIn" /></a>
        </div>
    </NotAuthorized>
</AuthorizeView>

