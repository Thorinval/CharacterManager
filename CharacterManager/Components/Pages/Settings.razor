@page "/settings"
@attribute [Microsoft.AspNetCore.Authorization.Authorize]
@using CharacterManager.Server.Data
@using CharacterManager.Server.Models
@using CharacterManager.Server.Services
@using Microsoft.EntityFrameworkCore
@using Microsoft.AspNetCore.Components.Authorization
@rendermode InteractiveServer

<link rel="stylesheet" href="/Styles/Settings.css" />

<PageTitle>Paramètres - Character Manager</PageTitle>

<div class="page-header-banner">
    <img src="/images/interface/parametres.png" alt="" class="page-header-icon" />
    <h1 class="page-title">Paramètres</h1>
</div>

<AuthorizeView>
    <Authorized>
<div class="settings-container">
    <!-- Section Langue -->
    <div class="settings-section">
        <div class="section-header">
            <h2>Localisation</h2>
        </div>

        <div class="setting-item">
            <div class="setting-label">
                <h3>Langue</h3>
                <p class="setting-description">
                    Choisissez la langue de l'interface
                </p>
            </div>
            <div class="setting-control">
                <select class="form-select" @bind="currentLanguage" @bind:after="OnLanguageChanged">
                    @foreach (var lang in availableLanguages)
                    {
                        <option value="@lang.Code">@lang.Name</option>
                    }
                </select>
            </div>
        </div>
    </div>

    <!-- Section Mode Adulte -->
    <div class="settings-section">
        <div class="section-header">
            <h2>Mode Contenu</h2>
        </div>

        <div class="setting-item">
            <div class="setting-label">
                <h3>Mode Adulte</h3>
                <p class="setting-description">
                    Lorsque le mode adulte est activé, toutes les images marquées comme contenu réservé aux adultes 
                    seront affichées. Désactivez cette option pour afficher uniquement les images alternatives.
                </p>
            </div>
            <div class="setting-control">
                <div class="form-check form-switch">
                    <input 
                        class="form-check-input" 
                        type="checkbox" 
                        id="adultModeToggle"
                        @bind:get="isAdultModeEnabled"
                        @bind:set="async (value) => { isAdultModeEnabled = value; await OnAdultModeChanged(); }"
                        disabled="@(!IsAdmin)" />
                    <label class="form-check-label" for="adultModeToggle">
                        @(isAdultModeEnabled ? "Activé" : "Désactivé")
                    </label>
                </div>
            </div>
        </div>
    </div>

    <!-- Section À propos -->
    <div class="settings-section">
        <div class="section-header">
            <h2>À propos</h2>
        </div>
        <div class="about-info">
            <p><strong>Character Manager</strong></p>
            <p>Version: @appVersion</p>
            <p class="text-muted">Une application pour gérer votre équipe de personnages.</p>
        </div>
    </div>
</div>
    </Authorized>
    <NotAuthorized>
        <div class="container mt-4">
            <p>Veuillez vous connecter pour modifier les paramètres.</p>
            <a class="btn btn-primary" href="/login">Se connecter</a>
        </div>
    </NotAuthorized>
</AuthorizeView>

