@page "/meilleur-escouade"

@attribute [Microsoft.AspNetCore.Authorization.Authorize]

@using CharacterManager.Server.Constants
@using CharacterManager.Server.Models
@using CharacterManager.Server.Services
@rendermode InteractiveServer
@using Microsoft.AspNetCore.Components.Web
@using CharacterManager.Components

@inject PersonnageService PersonnageService
@inject NavigationManager Navigation

<link rel="stylesheet" href="/Styles/Escouade.css" />

<div class="page-header-banner escouade-header clickable" @onclick="@(() => NavigateToCommandantDetail())">
    <div class="header-background-right" @onclick:stopPropagation="true">
        <img src="@GetCommandantHeaderImage()" alt="" class="header-bg-image" />
    </div>
    <a href="@AppConstants.Routes.Home" class="back-button" aria-label="Retour" title="Back to home" @onclick="() => {}" @onclick:stopPropagation="true"></a>
     <div class="header-center">
        <div class="puissance-header">
            <img src="@AppConstants.Paths.ImagesInterface/fond_puissance.png" alt="Puissance" class="puissance-image-header" onerror="this.style.display='none';" />
            <span class="puissance-number-header">@puissanceMax</span>
        </div>
    </div>   
    <div class="header-body" @onclick:stopPropagation="true">
        @if (topMercenaires.Any())
        {
            <div class="escouade-preview-section mb-0" @onclick:stopPropagation="true">
                <div class="escouade-images">
                    @for (int i = 0; i < topMercenaires.Count; i++)
                    {
                        var index = i;
                        var perso = topMercenaires[index];
                        var personnageId = perso.Id;
                        var returnPath = AppConstants.Routes.MeilleurEscouade;
                        <div class="escouade-member-preview clickable" @onclick="@(() => NavigateToDetail(personnageId, TemplateEscouade.GetFilterForMercenaires(), returnPath))" @onclick:stopPropagation="true">
                            <img src="@perso.GetImageUrl(true)" alt="@perso.Nom" class="escouade-image" />
                            <div class="escouade-member-name">@perso.Nom</div>
                            <div class="escouade-member-power">@perso.Puissance</div>
                        </div>
                    }
                </div>
            </div>
        }
    </div>
</div>

@if (topCommandant != null)
{
    <div class="section-header">
        <h2><LocalizedText Key="bestSquad.commander" /></h2>
    </div>
    <div class="personnages-list">
        @{
            var currentId = topCommandant.Id;
            var returnPath = AppConstants.Routes.MeilleurEscouade;
        }
        <div class="personnage-card clickable" @onclick="@(() => NavigateToDetail(currentId, TemplateEscouade.GetFilterForCommandants(), returnPath))">
            <img src="@topCommandant.GetImageUrl(true)" alt="@topCommandant.Nom" class="personnage-card-image" />
            <div class="personnage-card-info">
                <div class="personnage-name">@topCommandant.Nom</div>
                <div class="personnage-attribute"><span class="attribute-label">Rareté:</span> @topCommandant.Rarete</div>
                <div class="personnage-attribute"><span class="attribute-label">Puissance:</span> @topCommandant.Puissance</div>
                <div class="personnage-attribute"><span class="attribute-label">Niveau:</span> @topCommandant.Niveau</div>
                <div class="personnage-attribute"><span class="attribute-label">Rang:</span> @TemplateEscouade.GetRankStars(topCommandant.Rang)</div>
                <div class="personnage-attribute"><span class="attribute-label">Faction:</span> @topCommandant.Faction</div>
            </div>
        </div>
    </div>
}
<br />
<div class="section-header">
    <h2><LocalizedText Key="bestSquad.mercenaries" /> (@topMercenaires.Count)</h2>
</div>
<div class="personnages-list">
    @foreach (var perso in topMercenaires)
    {
        var personnageId = perso.Id;
        var personnageNom = perso.Nom;
        var returnPath = AppConstants.Routes.MeilleurEscouade;
        <div class="personnage-card clickable" @onclick="@(() => NavigateToDetail(personnageId, TemplateEscouade.GetFilterForMercenaires(), returnPath))">
            <img src="@perso.GetImageUrl(true)" alt="@personnageNom" class="personnage-card-image" />
            <div class="personnage-card-info">
                <div class="personnage-name">@personnageNom</div>
                <div class="personnage-attribute"><span class="attribute-label">Rareté:</span> @perso.Rarete</div>
                <div class="personnage-attribute"><span class="attribute-label">Puissance:</span> @perso.Puissance</div>
                <div class="personnage-attribute"><span class="attribute-label">Niveau:</span> @perso.Niveau</div>
                <div class="personnage-attribute"><span class="attribute-label">Rang:</span> @TemplateEscouade.GetRankStars(perso.Rang)</div>
                <div class="personnage-attribute"><span class="attribute-label">Faction:</span> @perso.Faction</div>
            </div>
        </div>
    }
</div>
<br />
<div class="section-header">
    <h2><LocalizedText Key="bestSquad.androids" /> (@topAndroides.Count)</h2>
</div>
<div class="personnages-list">
    @foreach (var perso in topAndroides)
    {
        var androideId = perso.Id;
        var androideNom = perso.Nom;
        var returnPath = AppConstants.Routes.MeilleurEscouade;
        <div class="personnage-card clickable" @onclick="@(() => NavigateToDetail(androideId,TemplateEscouade.GetFilterForAndroides(), returnPath))">
            <img src="@perso.GetImageUrl(true)" alt="@androideNom" class="personnage-card-image" />
            <div class="personnage-card-info">
                <div class="personnage-name">@androideNom</div>
                <div class="personnage-attribute"><span class="attribute-label">Rareté:</span> @perso.Rarete</div>
                <div class="personnage-attribute"><span class="attribute-label">Puissance:</span> @perso.Puissance</div>
                <div class="personnage-attribute"><span class="attribute-label">Niveau:</span> @perso.Niveau</div>
            </div>
        </div>
    }
</div>

<br />
<div class="section-header">
    <h2>Maison de Lucie (@luciePieces.Count)</h2>
</div>
@if (luciePieces.Count != 0)
{
    <div class="personnages-list">
        @foreach (var piece in luciePieces)
        {
            <div class="personnage-card lucie-piece-card @(piece.Selectionnee ? "lucie-piece-selected" : string.Empty)">
                <div class="personnage-card-info">
                    <div class="personnage-name">@piece.Nom</div>
                    <div class="personnage-attribute"><span class="attribute-label">Niveau:</span> @piece.Niveau</div>
                    <div class="personnage-attribute"><span class="attribute-label">Puissance:</span> @GetPiecePower(piece)</div>
                    <div class="personnage-attribute"><span class="attribute-label">Puissance tactique:</span> @piece.AspectsTactiques.Puissance</div>
                    <div class="personnage-attribute"><span class="attribute-label">Puissance stratégique:</span> @piece.AspectsStrategiques.Puissance</div>
                </div>
            </div>
        }
    </div>
}
else
{
    <div class="alert alert-info" role="alert">Aucune pièce sélectionnée</div>
}

