@page "/meilleur-escouade"
@attribute [Microsoft.AspNetCore.Authorization.Authorize]

@using CharacterManager.Server.Models
@using CharacterManager.Server.Services
@rendermode InteractiveServer
@using Microsoft.AspNetCore.Components.Web
@using CharacterManager.Components

@inject PersonnageService PersonnageService
@inject NavigationManager Navigation

<link rel="stylesheet" href="/Styles/Escouade.css" />

<div class="page-header-banner escouade-header clickable" @onclick="@(() => NavigateToCommandantDetail())">
    <div class="header-background-right" @onclick:stopPropagation="true">
        <img src="@GetCommandantHeaderImage()" alt="Commandant Background" class="header-bg-image" />
    </div>
    <a href="/" class="back-button" aria-label="Retour" title="Back to home" @onclick="() => {}" @onclick:stopPropagation="true"></a>
    <div class="header-body" @onclick:stopPropagation="true">
        @if (topMercenaires.Any())
        {
            <div class="escouade-preview-section mb-0" @onclick:stopPropagation="true">
                <div class="escouade-images">
                    @foreach (var perso in topMercenaires)
                    {
                        var currentId = perso.Id;
                        var returnPath = "/meilleur-escouade";
                        <div class="escouade-member-preview clickable" @onclick="@(() => NavigateToDetail(currentId, GetFilterForMercenaires(), returnPath))" @onclick:stopPropagation="true">
                            <img src="@perso.ImageUrlSelected" alt="@perso.Nom" class="escouade-image" onerror="this.onerror=null; this.src='/images/interface/default_portrait.png';" @onclick="@(() => NavigateToDetail(currentId, GetFilterForMercenaires(), returnPath))" @onclick:stopPropagation="true" />
                            <div class="escouade-member-name">@perso.Nom</div>
                            <div class="escouade-member-power">@perso.Puissance</div>
                        </div>
                    }
                </div>
            </div>
        }
    </div>
</div>

@if (topCommandant != null)
{
    <div class="personnages-list">
        @{
            var currentId = topCommandant.Id;
            var returnPath = "/meilleur-escouade";
        }
        <div class="personnage-card clickable" @onclick="@(() => NavigateToDetail(currentId, GetFilterForCommandants(), returnPath))">
            <img src="@topCommandant.ImageUrlPreview" alt="@topCommandant.Nom" class="personnage-card-image" onerror="this.onerror=null; this.src='/images/interface/default_portrait.png';" />
            <div class="personnage-card-info">
                <div class="personnage-name">@topCommandant.Nom</div>
                <div class="personnage-attribute"><span class="attribute-label">Rareté:</span> @topCommandant.Rarete</div>
                <div class="personnage-attribute"><span class="attribute-label">Puissance:</span> @topCommandant.Puissance</div>
                <div class="personnage-attribute"><span class="attribute-label">Niveau:</span> @topCommandant.Niveau</div>
                <div class="personnage-attribute"><span class="attribute-label">Rang:</span> @GetRankStars(topCommandant.Rang)</div>
                <div class="personnage-attribute"><span class="attribute-label">Faction:</span> @topCommandant.Faction</div>
            </div>
        </div>
    </div>
}
<br />
<div class="section-header">
    <h2><LocalizedText Key="bestSquad.mercenaries" /> (@topMercenaires.Count)</h2>
</div>
<div class="personnages-list">
    @foreach (var perso in topMercenaires)
    {
        var currentId = perso.Id;
        var returnPath = "/meilleur-escouade";
        <div class="personnage-card clickable" @onclick="@(() => NavigateToDetail(currentId, GetFilterForMercenaires(), returnPath))">
            <img src="@perso.ImageUrlPreview" alt="@perso.Nom" class="personnage-card-image" onerror="this.onerror=null; this.src='/images/personnages/default_portrait.png';" />
            <div class="personnage-card-info">
                <div class="personnage-name">@perso.Nom</div>
                <div class="personnage-attribute"><span class="attribute-label">Rareté:</span> @perso.Rarete</div>
                <div class="personnage-attribute"><span class="attribute-label">Puissance:</span> @perso.Puissance</div>
                <div class="personnage-attribute"><span class="attribute-label">Niveau:</span> @perso.Niveau</div>
                <div class="personnage-attribute"><span class="attribute-label">Rang:</span> @GetRankStars(perso.Rang)</div>
                <div class="personnage-attribute"><span class="attribute-label">Faction:</span> @perso.Faction</div>
            </div>
        </div>
    }
</div>
<br />
<div class="section-header">
    <h2><LocalizedText Key="bestSquad.androids" /> (@topAndroides.Count)</h2>
</div>
<div class="personnages-list">
    @foreach (var perso in topAndroides)
    {
        var currentId = perso.Id;
        var returnPath = "/meilleur-escouade";
        <div class="personnage-card clickable" @onclick="@(() => NavigateToDetail(currentId, GetFilterForAndroides(), returnPath))">
            <img src="@perso.ImageUrlPreview" alt="@perso.Nom" class="personnage-card-image" onerror="this.onerror=null; this.src='/images/personnages/default_portrait.png';" />
            <div class="personnage-card-info">
                <div class="personnage-name">@perso.Nom</div>
                <div class="personnage-attribute"><span class="attribute-label">Rareté:</span> @perso.Rarete</div>
                <div class="personnage-attribute"><span class="attribute-label">Puissance:</span> @perso.Puissance</div>
                <div class="personnage-attribute"><span class="attribute-label">Niveau:</span> @perso.Niveau</div>
            </div>
        </div>
    }
</div>

