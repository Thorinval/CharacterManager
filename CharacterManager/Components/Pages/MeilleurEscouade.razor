@page "/meilleur-escouade"
@attribute [Microsoft.AspNetCore.Authorization.Authorize]

@using CharacterManager.Server.Models
@using CharacterManager.Server.Services
@rendermode InteractiveServer
@using CharacterManager.Components

@inject PersonnageService PersonnageService
@inject NavigationManager Navigation

<link rel="stylesheet" href="/Styles/MeilleurEscouade.css" />

<PageTitle><LocalizedText Key="bestSquad.title" /></PageTitle>

<div class="page-header-banner escouade-header">
    <div class="header-left">
        <a href="/" class="back-button" title="Back to home">←</a>
        <img src="/images/interface/menu-icon.png" alt="" class="page-header-icon" />
    </div>

    <div class="header-center">
        <div class="puissance-header">
            <img src="/images/interface/fond_puissance.png" alt="Puissance" class="puissance-image-header" onerror="this.style.display='none';" />
            <span class="puissance-number-header">@puissanceMax</span>
        </div>
    </div>

    <div class="header-body">
        @if (topMercenaires.Any())
        {
            <div class="escouade-preview-section mb-0">
                <div class="escouade-images">
                    @foreach (var perso in topMercenaires)
                    {
                        var currentId = perso.Id;
                        var returnPath = "/meilleur-escouade";
                        <div class="escouade-member-preview clickable" @onclick="@(() => NavigateToDetail(currentId, GetFilterForMercenaires(), returnPath))">
                            <img src="@perso.ImageUrlSelected" alt="@perso.Nom" class="escouade-image" onerror="this.onerror=null; this.src='/images/interface/default_portrait.png';" />
                            <div class="escouade-member-name">@perso.Nom</div>
                            <div class="escouade-member-power">@perso.Puissance</div>
                        </div>
                    }
                </div>
            </div>
        }

        <div class="header-right">
            @if (topCommandant != null)
            {
                <img src="@topCommandant.ImageUrlPreview" alt="@topCommandant.Nom" class="commandant-hero" onerror="this.onerror=null; this.src='/images/interface/default_portrait.png';" />
            }
        </div>
    </div>

    <h1 class="page-title"><LocalizedText Key="bestSquad.title" /></h1>
</div>

<div class="section-header commandant-header">
        <h2><LocalizedText Key="bestSquad.commander" /></h2>
</div>
@if (topCommandant != null)
{
    <div class="personnages-list">
        @{
            var currentId = topCommandant.Id;
            var returnPath = "/meilleur-escouade";
        }
        <div class="personnage-card clickable" @onclick="@(() => NavigateToDetail(currentId, GetFilterForCommandants(), returnPath))">
            <img src="@topCommandant.ImageUrlPreview" alt="@topCommandant.Nom" class="personnage-card-image" onerror="this.onerror=null; this.src='/images/interface/default_portrait.png';" />
            <div class="personnage-card-info">
                <div class="personnage-name">@topCommandant.Nom</div>
                <div class="personnage-attribute"><span class="attribute-label">Rareté:</span> @topCommandant.Rarete</div>
                <div class="personnage-attribute"><span class="attribute-label">Puissance:</span> @topCommandant.Puissance</div>
                <div class="personnage-attribute"><span class="attribute-label">Niveau:</span> @topCommandant.Niveau</div>
                <div class="personnage-attribute"><span class="attribute-label">Rang:</span> @GetRankStars(topCommandant.Rang)</div>
                <div class="personnage-attribute"><span class="attribute-label">Faction:</span> @topCommandant.Faction</div>
            </div>
        </div>
    </div>
}
<br />
<div class="section-header">
    <h2><LocalizedText Key="bestSquad.mercenaries" /> (@topMercenaires.Count)</h2>
</div>
<div class="personnages-list">
    @foreach (var perso in topMercenaires)
    {
        var currentId = perso.Id;
        var returnPath = "/meilleur-escouade";
        <div class="personnage-card clickable" @onclick="@(() => NavigateToDetail(currentId, GetFilterForMercenaires(), returnPath))">
            <img src="@perso.ImageUrlPreview" alt="@perso.Nom" class="personnage-card-image" onerror="this.onerror=null; this.src='/images/personnages/default_portrait.png';" />
            <div class="personnage-card-info">
                <div class="personnage-name">@perso.Nom</div>
                <div class="personnage-attribute"><span class="attribute-label">Rareté:</span> @perso.Rarete</div>
                <div class="personnage-attribute"><span class="attribute-label">Puissance:</span> @perso.Puissance</div>
                <div class="personnage-attribute"><span class="attribute-label">Niveau:</span> @perso.Niveau</div>
                <div class="personnage-attribute"><span class="attribute-label">Rang:</span> @GetRankStars(perso.Rang)</div>
                <div class="personnage-attribute"><span class="attribute-label">Faction:</span> @perso.Faction</div>
            </div>
        </div>
    }
</div>
<br />
<div class="section-header">
    <h2><LocalizedText Key="bestSquad.androids" /> (@topAndroides.Count)</h2>
</div>
<div class="personnages-list">
    @foreach (var perso in topAndroides)
    {
        var currentId = perso.Id;
        var returnPath = "/meilleur-escouade";
        <div class="personnage-card clickable" @onclick="@(() => NavigateToDetail(currentId, GetFilterForAndroides(), returnPath))">
            <img src="@perso.ImageUrlPreview" alt="@perso.Nom" class="personnage-card-image" onerror="this.onerror=null; this.src='/images/personnages/default_portrait.png';" />
            <div class="personnage-card-info">
                <div class="personnage-name">@perso.Nom</div>
                <div class="personnage-attribute"><span class="attribute-label">Rareté:</span> @perso.Rarete</div>
                <div class="personnage-attribute"><span class="attribute-label">Puissance:</span> @perso.Puissance</div>
                <div class="personnage-attribute"><span class="attribute-label">Niveau:</span> @perso.Niveau</div>
            </div>
        </div>
    }
</div>

