@page "/templates"
@attribute [Microsoft.AspNetCore.Authorization.Authorize]
@rendermode InteractiveServer
@using CharacterManager.Server.Models
@using CharacterManager.Server.Services
@using CharacterManager.Components

<link rel="stylesheet" href="/Styles/Templates.css" />

<PageTitle><LocalizedText Key="templates.title" /></PageTitle>

<div class="page-header-banner">
    <a href="/" class="back-button" title="Back to home">‚Üê</a>
    <img src="/images/interface/menu-icon.png" alt="" class="page-header-icon" />
    <h1 class="page-title"><LocalizedText Key="templates.title" /></h1>
</div>

<Toast @ref="toastRef" />

@if (templates is null)
{
    <p><LocalizedText Key="common.loading" /></p>
}
else if (!templates.Any())
{
    <p><LocalizedText Key="templates.empty" /></p>
}
else
{
    <div class="templates-list">
        @foreach (var t in templates)
        {
            <div class="template-card">
                <div class="template-header">
                    @if (editingTemplateId == t.Id)
                    {
                        <input class="form-control form-control-sm" style="max-width: 240px; display:inline-block;" @bind="editingName" />
                        <button class="btn btn-sm btn-success ms-2" @onclick="(() => SaveRename(t))"><i class="bi bi-check"></i></button>
                        <button class="btn btn-sm btn-secondary ms-1" @onclick="CancelRename"><i class="bi bi-x"></i></button>
                    }
                    else
                    {
                        <span class="template-name">@t.Nom</span>
                        <button class="btn btn-sm btn-outline-secondary ms-2" @onclick="(() => StartRename(t))"><i class="bi bi-pencil"></i></button>
                    }
                    <span class="template-power"><LocalizedText Key="templates.power" /> <strong>@t.PuissanceTotal</strong></span>
                </div>
                <div class="template-meta">
                    <span><LocalizedText Key="templates.created" /> @t.DateCreation.ToLocalTime().ToString("yyyy-MM-dd HH:mm")</span>
                    <span><LocalizedText Key="templates.modified" /> @t.DateModification.ToLocalTime().ToString("yyyy-MM-dd HH:mm")</span>
                </div>
                <div class="template-actions">
                    <button class="btn btn-primary" @onclick="(() => OpenInInventaire(t.Id))">
                        <i class="bi bi-folder2-open"></i> <LocalizedText Key="templates.open" />
                    </button>
                    <button class="btn btn-info" @onclick="(() => ExportTemplate(t.Id))">
                        <i class="bi bi-download"></i> <LocalizedText Key="templates.export" /> CSV
                    </button>
                    <button class="btn btn-secondary" @onclick="(() => DuplicateTemplate(t.Id))">
                        <i class="bi bi-files"></i> <LocalizedText Key="templates.duplicate" />
                    </button>
                    <button class="btn btn-danger" @onclick="(() => DeleteTemplate(t.Id))">
                        <i class="bi bi-trash"></i> <LocalizedText Key="templates.delete" />
                    </button>
                </div>
            </div>
        }
    </div>
}




